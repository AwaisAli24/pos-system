<%- include('header.ejs') %>
  <%- include('sidebar.ejs') %>
    <div class="add">
      <!-- Button trigger modal -->
      <input type="text" name="id" class="form-control" id="code" placeholder="Enter id" autofocus />

      <!-- Modal -->
      <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Add Product</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form action="/product/add" method="post">
                <div class="mb-3">
                  <label for="id" class="form-label">Id</label>
                  <input type="text" name="id" class="form-control" id="addProductId" placeholder="Enter Id" readonly />
                </div>
                <div class="mb-3">
                  <label for="exampleFormControlInput1" class="form-label">Name</label>
                  <input type="text" name="name" class="form-control" id="exampleFormControlInput1"
                    placeholder="Enter name" />
                </div>
                <div class="mb-3">
                  <label for="exampleFormControlInput1" class="form-label">Price</label>
                  <input type="number" name="price" class="form-control" id="exampleFormControlInput1"
                    placeholder="Enter Price" />
                </div>
                <div class="mb-3">
                  <label for="exampleFormControlInput1" class="form-label">Quantity</label>
                  <input type="number" name="quantity" class="form-control" id="exampleFormControlInput1"
                    placeholder="Enetr Quantity" />
                </div>
                <input type="submit" name="" id="" value="Add Product" class="btn btn-primary">

              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
      <table class="table mt-5">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col" colspan="2">Name</th>
            <th scope="col" colspan="1">Price</th>
            <th scope="col" colspan="1">Quantity</th>
            <th scope="col">Operations</th>
          </tr>
        </thead>
        <tbody>
          <%products.forEach((product,index)=>{%>
            <tr>
              <th scope="row">
                <%=index+1%>
              </th>
              <td colspan="2">
                <%=product.name%>
              </td>
              <td>
                <%=product.price%>
              </td>
              <td>
                <%=product.quantity%>
              </td>
              <td>
                <button type="button" class="btn btn-warning" data-bs-toggle="modal"
                  data-bs-target="#editmodal<%=index%>">
                  Edit
                </button>

                <!-- Add product Modal -->
                <div class="modal fade" id="editmodal<%=index%>" tabindex="-1" aria-labelledby="exampleModalLabel"
                  aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Edit Product</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <form action="/product/<%=product.id%>?_method=PUT" method="post">
                          <div class="mb-3">
                            <label for="id" class="form-label">Id</label>
                            <input type="text" name="id" class="form-control" id="id" placeholder="Enter name"
                              value="<%=product.id%>" readonly />
                          </div>
                          <div class="mb-3">
                            <label for="exampleFormControlInput1" class="form-label">Name</label>
                            <input type="text" name="name" class="form-control" id="exampleFormControlInput1"
                              placeholder="Enter name" value="<%=product.name%>" />
                          </div>
                          <div class="mb-3">
                            <label for="exampleFormControlInput1" class="form-label">Price</label>
                            <input type="number" name="price" class="form-control" id="exampleFormControlInput1"
                              placeholder="Enter Price" value="<%=product.price%>" />
                          </div>
                          <div class="mb-3">
                            <label for="exampleFormControlInput1" class="form-label">Quantity</label>
                            <input type="number" name="quantity" class="form-control" id="exampleFormControlInput1"
                              placeholder="Enetr Quantity" value="<%=product.quantity%>" />
                          </div>
                          <input type="submit" name="" id="" value="Edit Product" class="btn btn-primary">

                        </form>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                          Close
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <!--Add Quantity Modal-->
                <div class="modal fade" id="addQuantityModal" tabindex="-1" role="dialog"
                  aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLong">Modal title</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <form action="/product/quantity/add" method="post">
                          <div class="mb-3">
                            <label for="addQuantityId" class="form-label">Id</label>
                            <input type="text" name="id" class="form-control" id="addQuantityId"
                              placeholder="Enter name" value="bulb" readonly />
                            <label for="addQuantityName" class="form-label">Name</label>
                            <input type="text" name="name" class="form-control" id="addQuantityName"
                              placeholder="Enter name" value="bulb" readonly />
                          </div>
                          <div class="mb-3">
                            <label for="addQuantityPrice" class="form-label">Price</label>
                            <input type="number" name="price" class="form-control" id="addQuantityPrice"
                              placeholder="Enter Price" readonly />
                          </div>
                          <div class="mb-3">
                            <label for="addQuantityQuantity" class="form-label">Quantity</label>
                            <input type="number" name="quantity" class="form-control" id="addQuantityQuantity"
                              placeholder="Enter Quantity" readonly />
                          </div>
                          <div class="mb-3">
                            <label for="addQuantityAddQuantity" class="form-label"> Add Quantity</label>
                            <input type="number" name="addedQuantity" class="form-control" id="addQuantityAddQuantity"
                              placeholder="Enter Quantity" />
                          </div>
                          <input type="submit" name="" id="" value="Done" class="btn btn-primary">

                        </form>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                          Close
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
    </div>
    </div>
    </div>
    <form action="/product/<%=product.id%>?_method=DELETE" method="post" style="display: inline;"><button
        class="btn btn-danger">Delete</button></form>
    </td>
    </tr>
    <%})%>
      </tbody>
      </table>
      </div>
      </div>
      <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script> -->
      <script src="/js/bootstrap.min.js"></script>
      <script>
        let input = document.querySelector("#code");
        const allProducts = <%- JSON.stringify(products) %>;
        const addProductModal = new bootstrap.Modal(document.getElementById("addProductModal"));
        const addQuantityModal = new bootstrap.Modal(document.getElementById("addQuantityModal"));
        const addProductId = document.querySelector("#addProductId");
        const addQuantityId = document.querySelector("#addQuantityId")
        const addQuantityName = document.querySelector("#addQuantityName")
        const addQuantityPrice = document.querySelector("#addQuantityPrice");
        const addQuantityQuantity = document.querySelector("#addQuantityQuantity");

        input.addEventListener("keypress", (e) => {

          if (e.key == "Enter") {
            const value = input.value;

            const product = allProducts.find(p => p.id == value);
            if (product) {
              addQuantityId.value = value;
              addQuantityName.value = product.name;
              addQuantityPrice.value = product.price;
              addQuantityQuantity.value = product.quantity;
              addQuantityModal.show();
            } else {
              addProductId.value = value;
              addProductModal.show();
            }
          }
        })
      </script>
      <%- include('footer.ejs') %>